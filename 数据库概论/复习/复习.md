<h1>数据库概论复习</h1>

[toc]

## 绪论
- 数据库
  - 定义
    - 数据库是长期储存在计算机内、有组织的、可共享的大量数据的集合
  - 基本特征
    - 数据按一定的数据模型组织、描述和储存
    - 可为各种用户共享
    - 冗余度较小
    - 数据独立性较高
    - 易扩展
- 数据库管理系统
  - 定义
    - 管理数据库与数据的一个软件系统，位于用户与操作系统之间
  - 主要功能（应该不会要求背）
    - 数据定义功能
    - 数据存储、组织和管理
    - 数据操纵功能
    - 数据库的事务管理和运行管理
    - 数据库的建立和维护功能
    - 其他功能
- 数据库系统
  - 定义
    - 数据库管理系统是由**数据库**、**数据库管理系统**、**应用程序**和**数据库管理员**组成的存储、管理、处理和维护数据的系统。
- 数据管理技术的阶段
  - 人工管理阶段
  - 文件系统阶段
  - 数据库系统阶段
- 两类数据模型
  - 概念模型
    - 也称信息模型，它是按用户的观点来对数据和信息建模，用于数据库设计
  - 逻辑模型和物理模型
    - 逻辑模型主要包括网状模型、层次模型、关系模型、面向对象数据模型、对象关系数据模型、半结构化数据模型等。按计算机系统的观点对数据建模，用于DBMS实现
    - 物理模型是对数据最底层的抽象，描述数据在系统内部的表示方式和存取方法，在磁盘或磁带上的存储方式和存取方法
- 常用的逻辑数据模型
  - 层次模型（Hierarchical Model）
  - 网状模型（Network Model）
  - 关系模型（Relational Model）
  - 面向对象数据模型（Object Oriented Data Model）
  - 对象关系数据模型（Object Relational Data Model）
  - 半结构化数据模型（Semistruture Data Model）
- 数据库系统的三级模式结构
  - 外模式
  - 模式
  - 内模式
- 数据库的二级映像系统
  - 外模式/模式映像
    - 保证了数据与程序的逻辑独立性（**数据的逻辑独立性**）
  - 模式/内模式映像
    - 保证了数据与程序的逻物理立性（**数据的物理独立性**）
## 关系数据库
- 候选码、主码和主属性
  - 候选码
    - 能唯一表示一个元组的**属性组**
  - 主码
    - 若有多个候选码，则选一个作为主码
  - 主属性
    - 候选码的各个属性被称为主属性
- 关系的三种类型
  - 基本关系（基本表）
  - 查询表
  - 视图表
- 关系的三类完整性
  -  实体完整性
     -  主码不能去空值
  -  参照完整性
     -  定义外码与主码之间的引用规则
  -  用户定义的完整性
     -  用户自己定义的，比如某个属性的取值
## SQL语言
- SQL集**数据查询**、**数据操纵**、**数据定义**和**数据控制**于一体，特点如下
  - 综合统一
  - 高度非过程化
  - 面向集合的操作方式
  - 以同一种语法结构提供多种使用方式
  - 语言简洁、易学易用
- 常见的索引
  - 顺序文件上的索引
  - B+树索引
  - Hash索引
  - 位图索引
- 视图的分类
  - 行列子集视图
  - 分组视图
- 视图的作用
  - 能够简化用户操作
  - 使用户可以从多个角度看数据
  - 可以提供一定的逻辑独立性
  - 对机密数据提供安全性保护
  - 适当使用可以更清晰的表达查询
## 数据库安全性
- 两个安全标准
  - TCSEC和CC（后者在前者基础上发展）
- DBMS提供的安全措施
  - 用户身份鉴别
  - 存取控制
    - 存取控制机制主要包括**定义用户权限**和**合法权限检查**。
    - 由它们俩引出了存储控制子系统 **自主存取控制（DAC）** 和 **强制存取控制（MAC）**
  - 视图技术和审计技术
    - 视图可以把不必要的数据隐藏起来，从而起到一定的保护作用
    - 审计
      - 启用一个专门的**审计日志**，将所有的操作记录在里面。审计员利用审计日志监控数据库中的各种行为，找出非法存取数据的人、时间和内容
      - C2以上安全级别的DBMS必须具有审计功能
  - 数据加密存储和加密传输
- 自主存取控制
  - 用户对于不同的数据库对象有不同的存取权限，不同的用户对同一对象也有不同的权限，而且用户可以将其拥有的权限授予其他用户。**（就是用户和数据库之间的访问权限不同，这种权限还可以授予）**
  - 用户权限由**数据库对象**和**操作类型**构成
  - 定义存取权限称为授权 
- 强制存取控制
  - 每个数据库对象被设置一个**密级**，每个用户也被授予一个**许可证**。对任意一个数据库对象，只有具有合法许可证的用户才可以存取。**（把大家的等级限定死了）**
  - 主体可以读**大于等于**自己密级等级的客体
  - 主体可以写**小于等于**自己密级的那估计的客体
## 数据库完整性
- 数据的完整性是指数据的**正确性**和**相容性**
- 为维护完整性，DBMS必须实现下面三种功能
  - 提供定义完整性约束条件的机制
  - 提供完整性检查的方法
  - 进行违约处理
- 实体完整性检查和违约处理
  - 检察主码是否唯一，如果不唯一则拒绝插入或修改
  - 检查主码的各个属性是否为空，只要有一个为空就拒绝插入或修改
- 参照完整性检查和违约处理
  - 参照书本160页
- 用户定义的完整性检查和违约处理
  - 属性上的约束条件（对某一列来说）
    - 在插入元组或修改属性值时，检查属性上的约束条件是否满足，不满足则不执行
  - 元组上的约束条件（对某一行来说，可以约束不同属性之间的关系）
    - 在插入元组或修改属性值时，检查元组上的约束条件是否满足，不满足则不执行
## 关系数据理论
- 不规范的关系模式可能存在的问题
  - 数据冗余
  - 插入异常
  - 删除异常
  - 修改复杂
- 范式
  - 1NF
    - 分量不可再分的就是1NF
  - 2NF
    - 在1NF的基础上，**非主属性**完全依赖于候选码（去除了部分依赖）
  - 3NF
    - 在2NF的基础上，**非主属性**不传递依赖于候选码（去除了候选码可以传递依赖推出非主属性）
  - BCNF
    - 在3NF的基础上，**主属性**不部分依赖于候选码，也不传递依赖于候选码（去除了候选码可以传递依赖 *or* 部分依赖推出**其他候选码的主属性**）
- Armstrong公理系统
  - 自反律
    - 若$Y\subseteq X\subseteq U$，则$X\rightarrow Y$为$F$所蕴含
  - 增广律
    - 若$X\rightarrow Y$为$F$所蕴含，且$Z\subseteq U$，则$XZ\rightarrow YZ$为$F$所蕴含
  - 传递律
    - 若$X\rightarrow Y$及$Y\rightarrow Z$为$F$所蕴含，则$X\rightarrow Z$为$F$所蕴含
- 根据上面推出的3条常用规则
  - 合并规则
    - $X\rightarrow Y$，$X\rightarrow Z$，可以推出$X\rightarrow YZ$
  - 伪传递规则
    - $X\rightarrow Y$，$WY\rightarrow Z$，可以推出$XW\rightarrow Z$
  - 分解规则
    - $X\rightarrow Y$，$Z\subseteq Y$，可以推出$X\rightarrow Z$
## 数据库设计
- 数据库设计的基本步骤
  - 需求分析
  - 概念结构设计
  - 逻辑结构设计
  - 物理结构设计
  - 数据库实施
  - 数据库运行和维护
- 需求分析
  - 会建立数据字典。它是对数据的描述而不是数据本身
  - 通常包括
    - 数据项
    - 数据结构
    - 数据流
    - 数据存储
    - 处理过程
- 概念结构设计
  - 会建立E-R图。矩形代表实体，椭圆代表属性，菱形代表联系
  - 集成E-R图的步骤
    - 合并（解决各分E-R图之间的冲突，将分E-R图合并起来生成初步E-R图）
    - 修改和重构（消除不必要的冗余，生成基本E-R图）
  - 合并时E-R图之间的三类冲突
    - 属性冲突
    - 命名冲突
    - 结构冲突
- 逻辑结构设计
  - 这一步把E-R图转换为与BDMS所支持的数据模型相符合的逻辑结构
- 物理结构设计
  - 物理结构定义
    - 数据库在物理设备上的**存储结构**和**存取方法**成为数据库的物理结构
  - 这步是为一个给定的逻辑数据模型选取一个最适合应用要求的物理结构的过程
  - 物理结构设计分为两步
    - 确定数据库的物理结构（在关系数据库中主要指存取方法和存储结构）
    - 对物理结构进行评价（时间效率和空间效率）
  - 
## 数据库编程
## 关系查询处理和查询优化
- 查询处理4个阶段
  - 查询分析
  - 查询检查
  - 查询优化
  - 查询执行
- 查询优化可分为
  - 代数优化（又叫做逻辑优化）
    - 查询树的启发式算法
      - **选择运算尽可能先做**
      - **把投影运算和选择运算同时进行**
      - 把投影同其前或后的双目运算结合起来
      - 把某些选择同在它前面要执行的笛卡尔积结合起来成为一个连接运算
      - 找出公共子表达式
  - 物理优化（又叫做非代数优化）
    - 基于规则的启发式优化
    - 基于代价估算的优化
    - 两者结合的优化方法
## 数据库恢复技术
- 事务的ACID特性
  - 原子性
  - 一致性
  - 隔离性
  - 持续性
- 故障的种类
  - 事务内部故障
  - 系统故障（也叫软故障）
  - 介质故障（也叫硬故障）
  - 计算机病毒
- 建立冗余数据最常用的技术
  - 数据转储
    - 动态转储
    - 静态转储
    - 上述俩都可以再分为海量转储和增量转储
  - 登记日志文件
    - 以记录为单位
    - 以数据库为单位（不涉及）
- 登记日志的原则
  - 登记的次序严格按并发事务执行的时间次序
  - 必须先写日志文件，后写数据库
## 并发控制
- 并发操作带来的数据不一致性
  - 丢失修改
  - 不可重复读
  - 读“脏数据”
- 并发控制主要技术
  - 封锁（主要学习内容）
  - 时间戳
  - 乐观控制法
  - 多版本并发控制
- 基本封锁类型
  - 排它锁（X锁）
  - 共享锁（S锁）
- 封锁协议
  - 一级封锁协议
    - 写之前一定要加X锁，写完立马释放
    - 可防止**丢失修改**
  - 二级封锁协议
    - 在一级封锁协议的基础上，读之前要加S锁，**读完释放**
    - 可防止**丢失修改和读“脏数据”**
  - 三级封锁协议
    - 在一级封锁协议的基础上，读之前要加S锁，**事务结束才释放**
    - 可防止**丢失修改、不可重复读和读“脏数据”**
- 活锁可以通过 ***FIFO*** 原则来解决
- 死锁
  - 死锁的预防
    - 一次封锁法
      - 一次性把要用的数据全锁了
      - 扩大了封锁范围，降低了系统的并发度
      - 很难确定要锁的全部数据，因此只能扩大封锁范围，进一步降低了并发度
    - 顺序封锁法
      - 对所有的数据对象拍一个顺序，封锁时要按照顺序去锁
      - 维护这个顺序代价很高，因为数据会动态变化
      - 需要封锁的数据也是动态变化的，很难事先确定要用哪些
  - 死锁的诊断与解除
    - 超时法
      - 一个事务的等待时间过长，就认为发生了死锁
      - 容易误判
      - 不能及时解除死锁
    - 等待图法
      - 生成一个事务等待图，$A$等待$B$，就拉一条$A\rightarrow B$的边。形成环，这说明死锁了
- 两段锁协议（**注意与一次封锁法的区别**）
  - 在对任何数据进行读、写操作之前，首先要申请并获得对该数据的封锁
  - 在释放一个封锁之后，事务不再申请和获得任何其他封锁
- 若并发执行的所有事务均遵守两段锁协议，则对这些事务的任何并发调度策略都是可串行化的
- 可串行化调度
  - 冲突可串行化调度是可串行调度的充分条件，不是必要条件
  - 事务遵守两段锁协议是可串行化调度的充分条件，而不是必要条件